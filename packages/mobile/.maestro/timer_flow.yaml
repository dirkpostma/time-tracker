appId: com.anonymous.mobile
---
- launchApp:
    clearKeychain: true

# Handle dev client launcher - tap the dev server URL
- tapOn:
    text: "http://localhost:8081"
    optional: true

# Wait for login screen
- extendedWaitUntil:
    visible: "Time Tracker"
    timeout: 30000

# Login first
- tapOn:
    id: "email-input"
- inputText: "test@example.com"

- tapOn:
    id: "password-input"
- inputText: "Test1234"

- tapOn:
    id: "login-button"

# Dismiss iOS password save dialog if it appears
- tapOn:
    text: "Not Now"
    optional: true

# Wait for timer screen
- extendedWaitUntil:
    visible:
      id: "timer-display"
    timeout: 30000

# Stop any existing running timer first
- tapOn:
    id: "stop-button"
    optional: true

# Wait for start button if we had to stop a timer
- extendedWaitUntil:
    visible:
      id: "start-button"
    timeout: 10000

# Verify initial state (timer at 00:00:00, start button visible)
- assertVisible:
    id: "timer-display"
- assertVisible:
    id: "start-button"

# Start the timer
- tapOn:
    id: "start-button"

# Handle client picker modal if it appears (first time use)
- tapOn:
    text: "Default Client"
    optional: true

# Skip project picker if it appears (auto-skips if no projects)
- tapOn:
    id: "project-skip"
    optional: true

# Wait for stop button to appear (indicates timer started)
- extendedWaitUntil:
    visible:
      id: "stop-button"
    timeout: 10000

# Verify timer is running (stop button visible, client name shown)
- assertVisible:
    id: "stop-button"
- assertVisible:
    id: "client-name"

# Wait a moment to see timer increment
- swipe:
    direction: DOWN
    duration: 2000

# Stop the timer
- tapOn:
    id: "stop-button"

# Wait for start button to reappear (indicates timer stopped)
- extendedWaitUntil:
    visible:
      id: "start-button"
    timeout: 10000

# Verify timer stopped
- assertVisible:
    id: "start-button"
- assertVisible:
    id: "timer-display"
